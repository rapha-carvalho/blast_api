services:
  api:
    image: ${API_IMAGE:-ghcr.io/rapha-carvalho/blast_api:latest}
    container_name: ga4-inspector-api
    environment:
      PORT: ${PORT:-3001}
      NODE_ENV: ${NODE_ENV:-production}
      MAX_BODY_MB: ${MAX_BODY_MB:-5}
      RATE_LIMIT_MAX: ${RATE_LIMIT_MAX:-20}
      RATE_LIMIT_WINDOW_MS: ${RATE_LIMIT_WINDOW_MS:-60000}
      ENABLE_DB: ${ENABLE_DB:-true}
      DB_PATH: ${DB_PATH:-/app/data/ga4-inspector.db}
      ALLOWED_ORIGINS: ${ALLOWED_ORIGINS:-https://blastgroup.org}
      ALLOW_CHROME_EXTENSION_ORIGINS: ${ALLOW_CHROME_EXTENSION_ORIGINS:-true}
      ALLOWED_EXTENSION_IDS: ${ALLOWED_EXTENSION_IDS:-}
      LOGO_PATH: ${LOGO_PATH:-/app/blast-logo.png}
    volumes:
      - ./data:/app/data
    expose:
      - "3001"
    restart: unless-stopped

  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: ga4-inspector-tunnel
    command: tunnel --no-autoupdate run --token ${CLOUDFLARE_TUNNEL_TOKEN}
    depends_on:
      - api
    restart: unless-stopped
